#ifndef PHYSICS_H
#define PHYSICS_H
#include "graphics.h"
#include "objects.h"
#include "state.h"

#define GRAVITY 9.8 

typedef struct Simulator Simulator;
typedef struct BallArray BallArray;
typedef struct CollisionArray CollisionArray;
typedef struct Settings Settings;

typedef struct PhysicsWorld {
  BallArray ball_array;
  CollisionArray collision_array;
  MassCenter* mass_center;
  Border* border;
  SDL_Rect* box;
  float CR;
} PhysicsWorld;

typedef struct Ball {
  float V;
  float angle;
  float x, y;
  float vx, vy;
  int radius;
  float mass;
  unsigned char color_r, color_g, color_b, color_a;
} Ball;

typedef struct CollisionData {
  Ball *a;
  Ball *b;
  float nx, ny;
  float overlap;
} CollisionData;

typedef struct MassCenter {
  int x, y;
  double vx, vy;
  double total_mass;
  int radius;
} MassCenter;

void update(Simulator *simulator);

void update_physics_step(PhysicsWorld* world, float delta_time);
void detect_collisions(BallArray *ball_array, CollisionArray *collision_array);
void resolve_static_collisions(CollisionArray *collision_array);
void resolve_dynamic_collisions(PhysicsWorld* world, Settings* settings, Resources* resources, State state);
void integrate_motion(Simulator *simulator, float delta_time);

void update_mass_center(MassCenter *mass_center, BallArray* ball_array);
void handle_wall_collision(Ball *b, Border *border_area, float restitution);

#endif
